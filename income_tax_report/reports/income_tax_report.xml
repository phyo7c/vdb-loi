<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="action_report_employee_tax" model="ir.actions.report">
        <field name="name">Income Tax Report</field>
        <field name="model">hr.employee.tax.report</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">income_tax_report.report_income_tax</field>
        <field name="report_file">income_tax_report.report_income_tax</field>
        <field name="print_report_name">(object._get_report_base_filename())</field>
    </record>

    <template id="report_income_tax">
        <t t-call="web.html_container">
            <t t-call="web.internal_layout">
                <div class="page">
                    <t t-foreach="docs" t-as="doc">
                        <center><t t-esc="doc.company_id.name"/></center>
                        <br/>
                        <div align="center">
                            <t t-set="info" t-value="get_header_info"/>
                            Personal Income Tax Calculation Financial Year <t t-esc="info['fiscal_year']"/>
                        </div>
                        <br/>
                        <table>
                            <tr>
                                <td>Employee ID:</td>
                                <td><t t-esc="doc.barcode"/></td>
                            </tr>
                            <tr>
                                <td>Employee Name:</td>
                                <td><t t-esc="doc.name"/></td>
                            </tr>
                            <tr>
                                <td>NRC Number:</td>
                                <td><t t-esc="doc.nrc"/></td>
                            </tr>
                            <tr>
                                <td>Position:</td>
                                <td><t t-esc="doc.job_title"/></td>
                            </tr>
                        </table>
                        <br/>
                        <t t-set="total_net_salary" t-value="0"/>
                        <t t-set="total_mmk" t-value="0"/>
                        <table class="table table-bordered mb32">
                            <thead>
                                <tr>
                                    <td align="center">Type of income</td>
                                    <td align="center">Net Salary (USD)</td>
                                    <td align="center">Months</td>
                                    <td align="center">Exchange Rate</td>
                                    <td align="center">MMK</td>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="doc.get_net_salary_lines(doc,info['fiscal_year_id'])" t-as="line">
                                    <tr>
                                        <td align="right"><t t-esc="line['type_of_income']"/></td>
                                        <td align="right">
                                            <t t-esc="'{0:,.2f}'.format(line['net_salary'])"/>
                                            <t t-set="total_net_salary" t-value="total_net_salary+line['net_salary']"/>
                                        </td>
                                        <td align="right"><t t-esc="'{0:,.2f}'.format(line['months'])"/></td>
                                        <td align="right"><t t-esc="'{0:,.2f}'.format(line['exchange_rate'])"/></td>
                                        <td align="right">
                                            <t t-if="line['type_of_income'] == 'Previous Net Salary'">
                                                <t t-esc="'{0:,.2f}'.format(line['mmk'])"/>
                                                <t t-set="total_mmk" t-value="total_mmk+line['mmk']"/>
                                            </t>
                                            <t t-if="line['type_of_income'] != 'Previous Net Salary'">
                                                <t t-esc="'{0:,.2f}'.format(line['mmk'])"/>
                                            </t>
                                        </td>
                                    </tr>
                                </t>
                                <tr>
                                    <td colspan="2" align="right">
                                        <t t-set="annual_total_income_usd" t-value="doc.get_annual_total_income(doc,info['fiscal_year_id'],'ATIUSD')"/>
                                        <span t-esc="'{0:,.2f}'.format(annual_total_income_usd['amount'])"/>
                                    </td>
                                    <td colspan="2" align="right">Total Annual Net Salary in MMK</td>
                                    <td align="right">
                                        <t t-set="annual_total_income" t-value="doc.get_annual_total_income(doc,info['fiscal_year_id'],'ATINC')"/>
                                        <span t-esc="'{0:,.2f}'.format(annual_total_income['amount'])"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="4" align="right">20% Exemption</td>
                                    <td align="right">
                                        <t t-set="twenty_percent_exemption" t-value="doc.get_annual_total_income(doc,info['fiscal_year_id'],'20P')"/>
                                        <span t-esc="'{0:,.2f}'.format(twenty_percent_exemption['amount'])"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="4" align="right">Spouse Allowance</td>
                                    <td align="right">
                                        <t t-set="spouse_exemption" t-value="doc.get_annual_total_income(doc,info['fiscal_year_id'],'SPE')"/>
                                        <span t-esc="'{0:,.2f}'.format(spouse_exemption['amount'])"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="4" align="right">Children Allowance</td>
                                    <td align="right">
                                        <t t-set="children_exemption" t-value="doc.get_annual_total_income(doc,info['fiscal_year_id'],'CDE')"/>
                                        <span t-esc="'{0:,.2f}'.format(children_exemption['amount'])"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="4" align="right">Parents Allowance</td>
                                    <td align="right">
                                        <t t-set="parent_exemption" t-value="doc.get_annual_total_income(doc,info['fiscal_year_id'],'PTE')"/>
                                        <span t-esc="'{0:,.2f}'.format(parent_exemption['amount'])"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="4" align="right">Life Insurance Premium during the year</td>
                                    <td align="right">
                                        <t t-set="life_insurance" t-value="doc.get_annual_total_income(doc,info['fiscal_year_id'],'INSE')"/>
                                        <span t-esc="'{0:,.2f}'.format(life_insurance['amount'])"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="4" align="right">SSB Contribution-Employee</td>
                                    <td align="right">
                                        <t t-set="ssb_amount" t-value="doc.get_annual_total_income(doc,info['fiscal_year_id'],'SSBE')"/>
                                        <span t-esc="'{0:,.2f}'.format(ssb_amount['amount'])"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="4" align="right">Total Taxable Income</td>
                                    <td align="right">
                                        <t t-set="ATI" t-value="doc.get_annual_total_income(doc,info['fiscal_year_id'],'ATI')"/>
                                        <span t-esc="'{0:,.2f}'.format(ATI['amount'])"/>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <table class="table table-bordered mb32">
                            <thead>
                                <tr>
                                    <td align="center">From</td>
                                    <td align="center">To</td>
                                    <td align="center">MMK</td>
                                    <td align="center">Rate</td>
                                    <td align="center">MMK</td>
                                    <td align="center">Annual PIT (MMK)</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td align="right"><span t-esc="'{0:,.0f}'.format(1)"/></td>
                                    <td align="right"><span t-esc="'{0:,.0f}'.format(2000000)"/></td>
                                    <td align="right"><span t-esc="'{0:,.0f}'.format(2000000)"/></td>
                                    <td align="center">0%</td>
                                    <td align="right">
                                        <t t-set="zero_percent_rate" t-value="doc.get_annual_total_income(doc,info['fiscal_year_id'],'0PA')"/>
                                        <span t-esc="'{0:,.2f}'.format(zero_percent_rate['amount'])"/>
                                    </td>
                                    <td align="right">
                                        0.00
                                    </td>
                                </tr>
                                <tr>
                                    <td align="right"><span t-esc="'{0:,.0f}'.format(2000001)"/></td>
                                    <td align="right"><span t-esc="'{0:,.0f}'.format(10000000)"/></td>
                                    <td align="right"><span t-esc="'{0:,.0f}'.format(8000000)"/></td>
                                    <td align="center">5%</td>
                                    <td align="right">
                                        <t t-set="five_percent_rate" t-value="doc.get_annual_total_income(doc,info['fiscal_year_id'],'5PA')"/>
                                        <span t-esc="'{0:,.2f}'.format(five_percent_rate['amount'])"/>
                                    </td>
                                    <td align="right">
                                        <t t-set="five_PPIT" t-value="doc.get_annual_total_income(doc,info['fiscal_year_id'],'5PPIT')"/>
                                        <span t-esc="'{0:,.2f}'.format(five_PPIT['amount'])"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td align="right"><span t-esc="'{0:,.0f}'.format(10000001)"/></td>
                                    <td align="right"><span t-esc="'{0:,.0f}'.format(30000000)"/></td>
                                    <td align="right"><span t-esc="'{0:,.0f}'.format(20000000)"/></td>
                                    <td align="center">10%</td>
                                    <td align="right">
                                        <t t-set="ten_percent_rate" t-value="doc.get_annual_total_income(doc,info['fiscal_year_id'],'10PA')"/>
                                        <span t-esc="'{0:,.2f}'.format(ten_percent_rate['amount'])"/>
                                    </td>
                                    <td align="right">
                                        <t t-set="ten_PPIT" t-value="doc.get_annual_total_income(doc,info['fiscal_year_id'],'10PPIT')"/>
                                        <span t-esc="'{0:,.2f}'.format(ten_PPIT['amount'])"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td align="right"><span t-esc="'{0:,.0f}'.format(30000001)"/></td>
                                    <td align="right"><span t-esc="'{0:,.0f}'.format(50000000)"/></td>
                                    <td align="right"><span t-esc="'{0:,.0f}'.format(20000000)"/></td>
                                    <td align="center">15%</td>
                                    <td align="right">
                                        <t t-set="fifteen_percent_rate" t-value="doc.get_annual_total_income(doc,info['fiscal_year_id'],'15PA')"/>
                                        <span t-esc="'{0:,.2f}'.format(fifteen_percent_rate['amount'])"/>
                                    </td>
                                    <td align="right">
                                        <t t-set="fifteen_PPIT" t-value="doc.get_annual_total_income(doc,info['fiscal_year_id'],'15PPIT')"/>
                                        <span t-esc="'{0:,.2f}'.format(fifteen_PPIT['amount'])"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td align="right"><span t-esc="'{0:,.0f}'.format(50000001)"/></td>
                                    <td align="right"><span t-esc="'{0:,.0f}'.format(70000000)"/></td>
                                    <td align="right"><span t-esc="'{0:,.0f}'.format(20000000)"/></td>
                                    <td align="center">20%</td>
                                    <td align="right">
                                        <t t-set="twenty_percent_rate" t-value="doc.get_annual_total_income(doc,info['fiscal_year_id'],'20PA')"/>
                                        <span t-esc="'{0:,.2f}'.format(twenty_percent_rate['amount'])"/>
                                    </td>
                                    <td align="right">
                                        <t t-set="twenty_PPIT" t-value="doc.get_annual_total_income(doc,info['fiscal_year_id'],'20PPIT')"/>
                                        <span t-esc="'{0:,.2f}'.format(twenty_PPIT['amount'])"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td align="right"><span t-esc="'{0:,.0f}'.format(70000001)"/></td>
                                    <td>and above</td>
                                    <td></td>
                                    <td align="center">25%</td>
                                    <td align="right">
                                        <t t-set="twenty_five_percent_rate" t-value="doc.get_annual_total_income(doc,info['fiscal_year_id'],'25PA')"/>
                                        <span t-esc="'{0:,.2f}'.format(twenty_five_percent_rate['amount'])"/>
                                    </td>
                                    <td align="right">
                                        <t t-set="twenty_five_PPIT" t-value="doc.get_annual_total_income(doc,info['fiscal_year_id'],'25PPIT')"/>
                                        <span t-esc="'{0:,.2f}'.format(twenty_five_PPIT['amount'])"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="4" align="right">Total Payable PIT for FY <t t-esc="info['fiscal_year']"/> (<t t-esc="info['start_month']"/> <t t-esc="info['start_year']"/> to <t t-esc="info['end_month']"/> <t t-esc="info['end_year']"/>)</td>
                                    <td align="right">
                                        <t t-set="PIT_ATI" t-value="doc.get_annual_total_income(doc,info['fiscal_year_id'],'ATI')"/>
                                        <span t-esc="'{0:,.2f}'.format(PIT_ATI['amount'])"/>
                                    </td>
                                    <td align="right">
                                        <t t-set="PIT_APT" t-value="doc.get_annual_total_income(doc,info['fiscal_year_id'],'APT')"/>
                                        <span t-esc="'{0:,.2f}'.format(PIT_APT['amount'])"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="5" align="right">Annual Personal Income Tax ("PIT") MMK</td>
                                    <td align="right">
                                        <t t-set="APT" t-value="doc.get_annual_total_income(doc,info['fiscal_year_id'],'APT')"/>
                                        <span t-esc="'{0:,.2f}'.format(APT['amount'])"/>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <t t-set="total_income_tax" t-value="0"/>
                        <table class="table table-bordered mb32">
                            <tr>
                                <td colspan="2" align="right">Balance</td>
                            </tr>
                            <t t-foreach="doc.get_income_tax_lines(doc,info['fiscal_year_id'])" t-as="line">
                                <tr>
                                    <td align="right"><t t-esc="line['name']"/></td>
                                    <td align="right">
                                        <t t-esc="'{0:,.2f}'.format(line['amount'])"/>
                                    </td>
                                </tr>
                            </t>
                            <tr>
                                <td colspan="2" align="right">
                                    <t t-set="final_APT" t-value="doc.get_annual_total_income(doc,info['fiscal_year_id'],'APT')"/>
                                    <span t-esc="'{0:,.2f}'.format(final_APT['amount'])"/>
                                </td>
                            </tr>
                        </table>
                    </t>
                </div>
            </t>
        </t>
    </template>
</odoo>
